<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø§Ø· â€”</title>
  <style>
    :root { --bg:#0f172a; --card:#1e293b; --accent:#22c55e; --danger:#ef4444; --muted:#94a3b8; --gold:#facc15; }
    body { font-family: Arial, sans-serif; background:var(--bg); color:white; padding:18px; margin:0; min-height:100vh; }
    header.appbar { position:sticky; top:0; z-index:30; background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); padding:10px 16px; display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid rgba(255,255,255,0.03); }
    header h1 { margin:0; font-size:18px; }
    .top-actions { display:flex; gap:8px; }
    .btn { padding:8px 10px; border-radius:8px; border:none; cursor:pointer; font-weight:600; }
    .btn-joke { background:#38bdf8; color:#000; }
    .btn-home { background:#86efac; color:#052e16; display:none; }
    .container { max-width:980px; margin:18px auto; padding:0 12px; box-sizing:border-box; }
    .card { background:var(--card); margin:12px 0; padding:14px; border-radius:10px; }
    .score { text-align:center; color:var(--gold); font-size:28px; margin:8px 0; }
    select,input { padding:10px; border-radius:8px; border:none; font-size:15px; width:100%; box-sizing:border-box; }
    .actions-row { display:flex; flex-wrap:wrap; gap:8px; justify-content:center; }
    button.action { background:var(--accent); color:#000; border:none; padding:8px 12px; border-radius:10px; cursor:pointer; }
    button.danger { background:var(--danger); color:#000; border:none; padding:8px 12px; border-radius:10px; cursor:pointer; }
    button.reward { background:#38bdf8; color:#000; border:none; padding:8px 12px; border-radius:10px; cursor:pointer; }
    button[disabled] { opacity:0.5; cursor:not-allowed; }
    #message { position:fixed; top:14px; left:50%; transform:translateX(-50%); min-width:220px; max-width:92%; padding:10px 14px; border-radius:8px; font-weight:700; color:#000; display:none; z-index:2000; box-shadow:0 6px 18px rgba(0,0,0,0.3); }
    #message.info { background:#bfdbfe; color:#022c52; }
    #message.success { background:#86efac; color:#052e16; }
    #message.warn { background:#fef08a; color:#4a3f00; }
    #message.error { background:#fecaca; color:#490000; }
    .meta { text-align:center; color:var(--muted); font-size:13px; margin-top:8px; }
    #joke { margin-top:12px; font-size:18px; color:#e6edf3; text-align:center; min-height:64px; }
    @media(max-width:520px){ header h1{font-size:16px;} .actions-row{gap:6px;} }
    .small { font-size:13px; color:var(--muted); }
    .controls { display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin-top:12px; }
    input[type=file] { display:none; }
  </style>
</head>
<body>
  <div id="message" role="status" aria-live="polite"></div>

  <header class="appbar">
    <h1>Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø§Ø· â€” </h1>
    <div class="top-actions">
      <button id="toJokesBtn" class="btn btn-joke">Ù…ÙØ§Ø¬Ø¦Ø©</button>
      <button id="toHomeBtn" class="btn btn-home">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    </div>
  </header>

  <main class="container">
    <!-- Login / Home -->
    <section id="homeView">
      <div class="card" id="loginCard">
        <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
        <label for="username" style="display:block;margin-bottom:8px;">Ø§Ø®ØªØ± Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
        <select id="username" aria-label="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
          <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø§Ø³Ù…</option>
          <option value="Ù…Ø­Ù…Ø¯ Ø§Ù„Ø®ÙŠØ±">Ù…Ø­Ù…Ø¯ Ø§Ù„Ø®ÙŠØ±</option>
          <option value="Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠØ§Ù†">Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠØ§Ù†</option>
        </select>
        <div style="margin-top:12px; text-align:center;">
          <button id="loginBtn" class="action" type="button">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        </div>
        <p class="meta small">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² ÙÙ‚Ø·.</p>
      </div>

      <div id="appArea" style="display:none">
        <div class="card">
          <div style="text-align:center; margin-bottom:8px;">
            <span id="currentUser"></span>
            <button id="logoutBtn" class="danger" type="button">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
          </div>
          <div id="score" class="score">0 Ù†Ù‚Ø·Ø©</div>
        </div>

        <div class="card">
          <h3>Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©</h3>
          <div class="actions-row">
            <button class="action" data-add="25" type="button">ÙƒÙ„ ØµÙ„Ø§Ø© (+25)</button>
            <button class="action" data-add="60" type="button">Ø¬Ù„Ø³Ø© Ø¯Ø±Ø§Ø³Ø© (+60)</button>
            <button class="action" data-add="50" type="button">Ø±ÙŠØ§Ø¶Ø© (+50)</button>
            <button class="action" data-add="150" type="button">Ø¥Ù†Ø¬Ø§Ø² 80% (+150)</button>
            <button class="action" data-add="40" type="button">Ø¯Ø±Ø§Ø³Ø© Ù…Ø³Ø§Ø¦ÙŠØ© (+40)</button>
            <button class="action" data-add="25" type="button">Ù‚Ø±Ø§Ø¡Ø© 30 Ø¯Ù‚ÙŠÙ‚Ø© (+25)</button>
            <button class="action" data-add="20" type="button">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø±ÙŠØ¹Ø© (+20)</button>
            <button class="action" data-add="15" type="button">ØªØ±ØªÙŠØ¨ Ø§Ù„ØºØ±ÙØ© (+15)</button>
            <button class="action" data-add="15" type="button">ØºØ³Ù„ Ø§Ù„Ø£ÙˆØ§Ù†ÙŠ (+15)</button>
          </div>
        </div>

        <div class="card">
          <h3>Ø§Ù„Ø¹Ø§Ø¯Ø§Øª Ø§Ù„Ø³ÙŠØ¦Ø©</h3>
          <div class="actions-row">
            <button class="danger" data-add="-150" type="button">Ù‡Ø§ØªÙ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¯Ø±Ø§Ø³Ø© (-150)</button>
            <button class="danger" data-add="-100" type="button">ØªØ£Ø®ÙŠØ± Ø§Ù„ØµÙ„Ø§Ø© (-100)</button>
            <button class="danger" data-add="-75" type="button">Ù†ÙˆÙ… Ù…ØªØ£Ø®Ø± (-75)</button>
            <button class="danger" data-add="-60" type="button">Ø¥Ù‡Ù…Ø§Ù„ Ø§Ù„ØªØ±ØªÙŠØ¨ (-60)</button>
            <button class="danger" data-add="-130" type="button">Ø¹Ø§Ø¯Ø© Ø³ÙŠØ¦Ø© (-130)</button>
            <button class="danger" data-add="-70" type="button">Ù…Ù…Ø§Ø·Ù„Ø© (-70)</button>
          </div>
        </div>

        <div class="card">
          <h3>Ù…ØªØ¬Ø± Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª</h3>
          <div class="actions-row">
            <button class="reward" data-redeem="40" type="button">15 Ø¯Ù‚ÙŠÙ‚Ø© Ù‡Ø§ØªÙ (-40)</button>
            <button class="reward" data-redeem="75" type="button">30 Ø¯Ù‚ÙŠÙ‚Ø© Ù‡Ø§ØªÙ (-75)</button>
            <button class="reward" data-redeem="150" type="button">Ø±Ø­Ù„Ø© Ù‚ØµÙŠØ±Ø© (-150)</button>
            <button class="reward" data-redeem="200" type="button">ÙˆØ¬Ø¨Ø© Ø®Ø§Ø±Ø¬ÙŠØ© (-200)</button>
            <button class="reward" data-redeem="300" type="button">Ù…Ø´Ø§Ù‡Ø¯Ø© ÙÙŠÙ„Ù… (-300)</button>
            <button class="reward" data-redeem="120" type="button">Ù‚Ø±Ø§Ø¡Ø© ÙƒØªØ§Ø¨ (-120)</button>
          </div>
        </div>

        <div class="card" style="text-align:center">
          <button id="exportBtn" class="action" type="button">ØªÙ†Ø²ÙŠÙ„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
          <label for="importFile" class="action" style="cursor:pointer; display:inline-block; background:#ffd166; color:#000;">Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø©</label>
          <input id="importFile" type="file" accept="application/json" />
        </div>
      </div>
    </section>

    <!-- Jokes -->
    <section id="jokesView" style="display:none">
      <div class="card">
        <h2>Ù…ÙˆÙ„Ø¯ Ø§Ù„Ù†ÙƒØ§Øª </h2>
        <div class="controls">
          <select id="categorySelect" aria-label="Ø§Ø®ØªØ± ÙØ¦Ø© Ø§Ù„Ù†ÙƒØ§Øª" style="max-width:220px;">
            <option value="any">ÙƒÙ„ Ø§Ù„ÙØ¦Ø§Øª</option>
            <option value="programming">Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©</option>
            <option value="misc">Ù…ØªÙØ±Ù‚Ø§Øª</option>
            <option value="pun">ØªÙ„Ø§Ø¹Ø¨ Ø¨Ø§Ù„Ø£Ù„ÙØ§Ø¸</option>
          </select>
          <button id="getJokeBtn" class="action" type="button">Ù†ÙƒØªØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©</button>
          <button id="copyJokeBtn" class="action" type="button">Ù†Ø³Ø® Ø§Ù„Ù†ÙƒØªØ©</button>
        </div>
        <div id="joke" aria-live="polite">   Ø§Ø¶ØºØ· Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†ÙƒØªØ©  ğŸ˜„</div>
        <div class="meta" id="jokeMeta"></div> 
      </div>
    </section>
  </main>

  <script>
    // Offline-only app (no Firebase)
    const msgEl = document.getElementById('message');
    function showMessage(text, type='info', duration=3000){
      if(!msgEl) return;
      msgEl.className = '';
      msgEl.classList.add(type);
      msgEl.textContent = text;
      msgEl.style.display = 'block';
      if(duration>0) setTimeout(()=> msgEl.style.display = 'none', duration);
    }

    // Keys
    const localScoreKey = u => 'score_' + encodeURIComponent(u || '');

    function readLocal(user){ if(!user) return 0; const v = localStorage.getItem(localScoreKey(user)); return v !== null ? Number(v) || 0 : 0; }
    function writeLocal(user, val){ if(!user) return; localStorage.setItem(localScoreKey(user), String(Number(val||0))); }

    // UI elements
    const toJokesBtn = document.getElementById('toJokesBtn');
    const toHomeBtn = document.getElementById('toHomeBtn');
    const homeView = document.getElementById('homeView');
    const jokesView = document.getElementById('jokesView');
    const usernameSelect = document.getElementById('username');
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const appArea = document.getElementById('appArea');
    const currentUserSpan = document.getElementById('currentUser');
    const scoreEl = document.getElementById('score');
    const exportBtn = document.getElementById('exportBtn');
    const importFile = document.getElementById('importFile');

    // Jokes dataset (offline)
    const JOKES = [
      { category:'programming', type:'single', joke:'Ù„Ù…Ø§Ø°Ø§ ÙŠÙƒØ±Ù‡ Ø§Ù„Ù…Ø¨Ø±Ù…Ø¬ÙˆÙ† Ø§Ù„Ø·Ø¨ÙŠØ¹Ø©ØŸ Ù„Ø£Ù†Ù‡Ø§ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ«ÙŠØ± Ù…Ù† Ø§Ù„Ø£Ø®Ø·Ø§Ø¡.' },
      { category:'programming', type:'single', joke:'ÙƒÙŠÙ ØªØ³Ø£Ù„ Ù…Ø·ÙˆÙ‘Ø± Ø¹Ù† Ø§Ù„ÙˆÙ‚ØªØŸ Ø§Ø·Ù„Ø¨ Ù…Ù†Ù‡ commit Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø³Ø§Ø¹Ø©.' },
      { category:'misc', type:'single', joke:'Ù„Ù…Ø§Ø°Ø§ ÙˆØ¶Ø¹ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø³Ø§Ø¹ØªÙ‡ ÙÙŠ Ø§Ù„Ø«Ù„Ø§Ø¬Ø©ØŸ Ù„Ø£Ù†Ù‡ Ø£Ø±Ø§Ø¯ ÙˆÙ‚ØªÙ‹Ø§ Ø£ÙƒØ«Ø± Ø¨Ø§Ø±Ø¯Ù‹Ø§.' },
      { category:'pun', type:'twopart', setup:'Ù„Ù…Ø§Ø°Ø§ Ù„Ø§ ÙŠØ´Ø§Ø±Ùƒ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¹Ø¸Ù…ÙŠ Ø£Ø³Ø±Ø§Ø±Ù‡ØŸ', delivery:'Ù„Ø£Ù†Ù‡ Ù„Ø§ ÙŠÙ…Ù„Ùƒ Ù‚Ù„Ø¨Ù‹Ø§ Ù„ÙŠØ¶Ø¹ Ø«Ù‚ØªÙ‡.' },
      { category:'misc', type:'single', joke:'Ø³Ø£Ù„ Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ø·Ø§Ù„Ø¨: Ù„Ù…Ø§Ø°Ø§ ØªØ£Ø®Ø±ØªØŸ Ù‚Ø§Ù„: Ø§Ù„Ù…Ø¯Ø±Ø³Ø© ÙƒØ§Ù†Øª Ù…ØºÙ„Ù‚Ø© Ù„Ù„ØªÙ…Ø§Ø±ÙŠÙ†.' },
      { category:'programming', type:'twopart', setup:'Ù…Ø§ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ù…Ø·ÙˆÙ‘Ø± ÙˆÙƒØ³Ø§Ø±Ø© Ø§Ù„Ø¨Ù†Ø¯Ù‚ØŸ', delivery:'Ø§Ù„ÙƒØ³Ø§Ø±Ø© ØªØ¹Ø·ÙŠÙƒ Ø­Ù„Ù‹Ø§ Ø¨Ø³Ø±Ø¹Ø©.' },
      { category:'pun', type:'single', joke:'Ù‚Ø±Ø±Øª Ø£Ù† Ø£ØµØ¨Ø­ Ù…ÙˆØ³ÙŠÙ‚ÙŠÙ‹Ø§â€¦ Ù„ÙƒÙ† Ù„Ù… Ø£Ø¬Ø¯ Ù†ØºÙ…Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©.' },
      { category:'misc', type:'single', joke:'Ø§Ù„Ø£Ø¨ Ù„Ø§Ø¨Ù†Ù‡: Ø¥Ø°Ø§ Ù†Ø¬Ø­Øª Ø³Ø£Ø¹Ø·ÙŠÙƒ Ø³ÙŠØ§Ø±Ø©. Ø§Ù„Ø§Ø¨Ù†: ÙˆÙ…Ø§Ø°Ø§ Ù„Ùˆ Ù„Ù… Ø£Ù†Ø¬Ø­ØŸ Ø§Ù„Ø£Ø¨: Ø³Ø£Ø¹Ø·ÙŠÙƒ Ù†ØµÙŠØ­Ø©.' },
      { category:'programming', type:'single', joke:'ØªØ¹Ù„Ù…Øª Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ù…Ù† Ø§Ù„ØµÙØ± â€” Ø«Ù… ÙˆØµÙ„Ù†ÙŠ Ø®Ø·Ø£ Ø§Ù„Ù€NullPointer.' },
      { category:'pun', type:'twopart', setup:'Ù„Ù‚Ø¯ Ø§Ø´ØªØ±ÙŠØª ÙƒØªØ§Ø¨Ù‹Ø§ Ø¹Ù† Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ø°Ø§ØªÙŠ.', delivery:'Ù„ÙƒÙ†Ù†ÙŠ ÙˆØ¬Ø¯Øª Ø§Ù„ØµÙØ­Ø© ÙØ§Ø±ØºØ© â€” Ù„Ø£Ù†Ùƒ Ø£Ù†Øª Ø§Ù„Ù…Ù†ØªØ¬.' }
    ];

    // Helper: random joke by category
    function getRandomJoke(category='any'){
      const list = JOKES.filter(j => category==='any' || j.category===category);
      if(list.length===0) return null;
      return list[Math.floor(Math.random()*list.length)];
    }

    // Navigation
    toJokesBtn.addEventListener('click', ()=> {
      homeView.style.display = 'none';
      jokesView.style.display = 'block';
      toJokesBtn.style.display = 'none';
      toHomeBtn.style.display = 'inline-block';
    });
    toHomeBtn.addEventListener('click', ()=> {
      jokesView.style.display = 'none';
      homeView.style.display = 'block';
      toJokesBtn.style.display = 'inline-block';
      toHomeBtn.style.display = 'none';
    });

    // Login/logout
    let currentUser = null;
    function setLoggedIn(user){
      currentUser = user;
      currentUserSpan.textContent = 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ' + user;
      appArea.style.display = 'block';
      document.getElementById('loginCard').style.display = 'none';
      // load score from local
      const s = readLocal(user) || 0;
      scoreEl.textContent = s + ' Ù†Ù‚Ø·Ø©';
      showMessage('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø­Ù„ÙŠÙ‹Ø§', 'success', 1200);
    }
    function setLoggedOut(){
      currentUser = null;
      currentUserSpan.textContent = '';
      appArea.style.display = 'none';
      document.getElementById('loginCard').style.display = 'block';
      scoreEl.textContent = '0 Ù†Ù‚Ø·Ø©';
      showMessage('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'info', 1000);
    }

    loginBtn.addEventListener('click', ()=>{
      const val = usernameSelect.value;
      if(!val){ showMessage('Ø§Ø®ØªØ± Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹','warn'); return; }
      setLoggedIn(val);
      localStorage.setItem('currentUser', val);
    });
    logoutBtn.addEventListener('click', ()=>{
      localStorage.removeItem('currentUser');
      setLoggedOut();
    });

    // Actions
    function applyDelta(user, delta){
      if(!user) { showMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹','warn'); return; }
      const cur = readLocal(user) || 0;
      const next = cur + Number(delta);
      writeLocal(user, next);
      scoreEl.textContent = next + ' Ù†Ù‚Ø·Ø©';
      showMessage('ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù…Ø­Ù„ÙŠÙ‹Ø§', 'success', 1000);
    }
    // wire action buttons
    document.querySelectorAll('button[data-add]').forEach(b => b.addEventListener('click', ()=> applyDelta(currentUser, Number(b.dataset.add))));
    document.querySelectorAll('button[data-redeem]').forEach(b => b.addEventListener('click', ()=> applyDelta(currentUser, -Number(b.dataset.redeem))));

    // Backup (download all scores)
    exportBtn.addEventListener('click', () => {
      const out = {};
      for(let i=0;i<localStorage.length;i++){
        const key = localStorage.key(i);
        if(key && key.startsWith('score_')){
          out[key] = localStorage.getItem(key);
        }
      }
      const blob = new Blob([JSON.stringify(out, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'points-backup.json';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      showMessage('ØªÙ… ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©', 'success', 1400);
    });

    // Import/restore
    importFile.addEventListener('change', (e) => {
      const f = e.target.files && e.target.files[0];
      if(!f) return;
      const reader = new FileReader();
      reader.onload = (ev) => {
        try {
          const data = JSON.parse(ev.target.result);
          let count = 0;
          for(const k in data){
            if(k.startsWith('score_')){
              localStorage.setItem(k, String(data[k]));
              count++;
            }
          }
          showMessage(`ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© ${count} Ù…Ø¯Ø®Ù„Ø§Ù‹ Ù…Ø­Ù„ÙŠÙ‹Ø§`, 'success', 1800);
          // if current user affected update UI
          if(currentUser) {
            scoreEl.textContent = (readLocal(currentUser)||0) + ' Ù†Ù‚Ø·Ø©';
          }
        } catch(err){
          console.error('import error', err);
          showMessage('ÙØ´Ù„ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© â€” Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­', 'error', 2200);
        }
      };
      reader.readAsText(f);
      // clear input
      e.target.value = '';
    });

    // Jokes functionality (offline)
    const getJokeBtn = document.getElementById('getJokeBtn');
    const copyJokeBtn = document.getElementById('copyJokeBtn');
    const jokeDiv = document.getElementById('joke');
    const jokeMeta = document.getElementById('jokeMeta');
    const categorySelect = document.getElementById('categorySelect');

    getJokeBtn.addEventListener('click', ()=> {
      const cat = categorySelect.value || 'any';
      const map = { any:'any', programming:'programming', misc:'misc', pun:'pun' };
      const jk = getRandomJoke(cat);
      if(!jk){ jokeDiv.textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ÙƒØ§Øª Ù„Ù„ÙØ¦Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©.'; jokeMeta.textContent = ''; return; }
      if(jk.type === 'single'){ jokeDiv.innerHTML = `<div class="setup">${jk.joke}</div><div class="delivery"></div>`; }
      else { jokeDiv.innerHTML = `<div class="setup">${jk.setup}</div><div class="delivery">${jk.delivery}</div>`; }
      jokeMeta.textContent = `ÙØ¦Ø©: ${jk.category || 'Ø¹Ø§Ù…'}`;
    });

    copyJokeBtn.addEventListener('click', async ()=>{
      try {
        const text = jokeDiv.textContent || '';
        if(!text.trim()){ showMessage('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ÙƒØªØ© Ù„Ù†Ø³Ø®Ù‡Ø§', 'warn'); return; }
        await navigator.clipboard.writeText(text);
        showMessage('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†ÙƒØªØ©', 'success', 1200);
      } catch(err){
        console.error('copy failed', err);
        showMessage('ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø® â€” Ù‚Ø¯ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ù…ØªØµÙØ­ Ø°Ù„Ùƒ', 'error', 1600);
      }
    });

    function getRandomJoke(category='any'){
      const list = JOKES.filter(j => category==='any' || j.category===category);
      if(list.length === 0) return null;
      return list[Math.floor(Math.random()*list.length)];
    }

    // restore session if any
    const saved = localStorage.getItem('currentUser');
    if(saved){
      usernameSelect.value = saved;
      setTimeout(()=> { loginBtn.click(); }, 200);
    }
  </script>
</body>
</html>
